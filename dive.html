<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Dive</title>

    <!-- Locomotive Scroll CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/locomotive-scroll@4.1.4/dist/locomotive-scroll.min.css" />

    <!-- link style.css -->
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- A fixed background video -->
    <div class="fixedVideo">
        <video autoplay loop muted playsinline webkit-playsinline></video>
    </div>

    <!-- Locomotive Scroll container -->
    <div data-scroll-container>

        <!-- Section 1 -->
        <section data-scroll-section>
            <p data-scroll data-scroll-speed="1" style="color:white">
                Click to begin the sound of descent.
            </p>
            <p data-scroll data-scroll-speed="1" style="color:white">
                As you scroll-dive, you may pause to hover.
            </p>
        </section>

        <!-- Section 2 -->
        <section data-scroll-section>
            <h1 data-scroll>Sa sinugdanan </h1>
            <p data-scroll data-scroll-speed="3" style="color:white">
                In the beginning
            </p>
        </section>

        <!-- A section with text AND a GIF going right-to-left -->
        <section data-scroll-section>
            <div class="scroll-gif-container" id="gif-scroll-target">
                <!-- A paragraph that might move slightly or stay still -->
                <p data-scroll data-scroll-speed="1" data-scroll-target="#gif-scroll-target">
                    all searching eye for truth
                </p>

                <!-- The GIF going from right to left -->
                <img src="images/illustrations/Caracoa.gif" alt="Butuan Expedition GIF" data-scroll
                    data-scroll-direction="horizontal" data-scroll-speed="-5" data-scroll-target="#gif-scroll-target"
                    class="butuan-gif" />
            </div>
        </section>

        <section data-scroll-section>
            <div class="scroll-gif-container" id="gif-scroll-target">
                <!-- A paragraph that might move slightly or stay still -->
                <p data-scroll data-scroll-speed="2" data-scroll-target="#gif-scroll-target">
                    in the computation of time
                </p>
            </div>
        </section>

        <!-- each letter has its own vertical scrolling -->
        <section data-scroll-section class="">
            <span class="c-lerp-block_title" data-scroll>
                <!-- Each letter has its own speed or delay -->
                <span data-scroll data-scroll-delay="0.13" data-scroll-speed="1">a</span>
                <span data-scroll data-scroll-delay="0.12" data-scroll-speed="2">n</span>
                <span data-scroll data-scroll-delay="0.11" data-scroll-speed="3"> </span>
                <span data-scroll data-scroll-delay="0.10" data-scroll-speed="4">i</span>
                <span data-scroll data-scroll-delay="0.09" data-scroll-speed="5">n</span>
                <span data-scroll data-scroll-delay="0.08" data-scroll-speed="6">f</span>
                <span data-scroll data-scroll-delay="0.07" data-scroll-speed="7">i</span>
                <span data-scroll data-scroll-delay="0.06" data-scroll-speed="8">n</span>
                <span data-scroll data-scroll-delay="0.05" data-scroll-speed="9">i</span>
                <span data-scroll data-scroll-delay="0.04" data-scroll-speed="10">t</span>
                <span data-scroll data-scroll-delay="0.03" data-scroll-speed="11">y</span>
            </span>
        </section>

        <!-- now moving left to right -->
        <section data-scroll-section>
            <div class="scroll-gif-container" id="gif-scroll-target2">
                <!-- A paragraph that might move slightly or stay still -->
                <p data-scroll data-scroll-speed="1" data-scroll-target="#gif-scroll-target2">
                    we entered by storm, preserved by plunder
                </p>

                <!-- The GIF going from right to left -->
                <a href="https://philippinestudies.uk/mapping/"><img src="images/mpc/MPC_Gold.gif" alt="MPC_Gold"
                        data-scroll data-scroll-direction="horizontal" data-scroll-speed="5"
                        data-scroll-target="#gif-scroll-target2" class="MPC_Gold" /></a>
            </div>
        </section>

        <!-- A section with text AND a GIF going right-to-left -->
        <section data-scroll-section>
            <div class="scroll-gif-container" id="gif-scroll-target">
                <!-- A paragraph that might move slightly or stay still -->
                <p data-scroll data-scroll-speed="1" data-scroll-target="#gif-scroll-target">
                    threatened to be put by the sword
                </p>

                <!-- The GIF going from right to left -->
                <a href="https://philippinestudies.uk/mapping/"><img src="images/mpc/sword.gif" alt="sword" data-scroll
                        data-scroll-direction="horizontal" data-scroll-speed="-4"
                        data-scroll-target="#gif-scroll-target" class="sword" /></a>
            </div>
        </section>



        <!-- horizontal scrolling -->
        <section data-scroll-section class="dark">
            <div data-scroll data-scroll-direction="horizontal" data-scroll-speed="5"
                style="color: white; padding: 1rem;">
                <img src="images/mpc/MPC_FuneraryMask.gif">
            </div>
        </section>

        <section data-scroll-section class="dark">
            <div data-scroll data-scroll-direction="horizontal" data-scroll-speed="-15"
                style="color: white; padding: 1rem;">
                <img src="images/maps/Map_Order-of-Hermits.gif">
            </div>
        </section>

        <section data-scroll-section class="dark">
            <div data-scroll data-scroll-direction="horizontal" data-scroll-speed="5"
                style="color: white; padding: 1rem;">
                <a href="https://philippinestudies.uk/mapping/"><img src="images/mpc/handkerchief.gif"></a>
            </div>
        </section>


        <!-- fade in -->
        <!-- Section 2: Show fade-in with no parallax movement -->
        <section data-scroll-section class="dark">
            <p data-scroll data-scroll-class="fade-in" data-scroll-speed="0" style="font-size: 2rem;padding: 1rem;">
                the parallel betwixt us
            </p>
        </section>

        <section data-scroll-section class="dark">
            <div data-scroll data-scroll-direction="horizontal" data-scroll-speed="5"
                style="color: white; padding: 1rem;">
                <img src="images/illustrations/badlit.gif">
            </div>
        </section>

        <!-- now moving left to right -->
        <section data-scroll-section>
            <div class="scroll-gif-container" id="gif-scroll-target2">
                <!-- A paragraph that might move slightly or stay still -->
                <p data-scroll data-scroll-speed="1" data-scroll-target="#gif-scroll-target2">
                    my silence, perhaps, may be misconstrued
                </p>

                <!-- The GIF going from right to left -->
                <img src="images/illustrations/Caracoa.gif" alt="caracoa" data-scroll data-scroll-direction="horizontal"
                    data-scroll-speed="5" data-scroll-target="#gif-scroll-target2" class="caracoa" />
        </section>

        <section data-scroll-section class="dark">
            <p data-scroll data-scroll-class="fade-in" data-scroll-speed="0" style="font-size: 2rem;padding: 1rem;">
                I will fade away forever. again.
            </p>
        </section>


        <!-- stacking section -->
        <section data-scroll data-scroll-section data-scroll-id="stack-section" class="dark" id="stack-section">
            <div class="stack-container">
                <img class="stack-gif" id="gif1" src="images/mpc/gravemarker.gif" alt="gravemarker" width="300" />
                <img class="stack-gif" id="gif2" src="images/mpc/gravemarker2.gif" alt="gravemarker2" width="300" />
                <img class="stack-gif" id="gif3" src="images/mpc/brass2.gif" alt="brass1" width="300" />
            </div>
        </section>


    </div>

    <!-- Locomotive Scroll JS -->
    <script src="https://cdn.jsdelivr.net/npm/locomotive-scroll@4.1.4/dist/locomotive-scroll.min.js"></script>

    <!-- include main.js -->
    <!-- <script src="main.js"></script> -->

    <script>
        // Initialize Locomotive Scroll with mobile support
        const scroll = new LocomotiveScroll({
            el: document.querySelector('[data-scroll-container]'),
            smooth: true,
            smartphone: {
                smooth: true,
                horizontalGesture: true,
                breakpoint: 767
            },
            tablet: {
                smooth: true,
                breakpoint: 1024
            }
        });

        // On resize, update the locomotive instance
        window.addEventListener('resize', () => {
            if (scroll) scroll.update();
        });

        // Handle video autoplay
        const video = document.querySelector('.fixedVideo video');

        // Set video source based on screen width
        function setVideoSource() {
            const isMobile = window.innerWidth <= 767;
            video.src = isMobile ? 'videos/dive_vertical.mp4' : 'videos/dive.mp4';
        }

        // Set initial video source
        setVideoSource();

        // Update video source on resize
        window.addEventListener('resize', setVideoSource);

        // Handle touch events for mobile
        let touchStartY = 0;
        let touchEndY = 0;

        document.addEventListener('touchstart', (e) => {
            touchStartY = e.touches[0].clientY;
        }, false);

        document.addEventListener('touchmove', (e) => {
            touchEndY = e.touches[0].clientY;
        }, false);

        document.addEventListener('touchend', () => {
            const touchDiff = touchStartY - touchEndY;
            if (Math.abs(touchDiff) > 50) { // Minimum swipe distance
                lastScrollTime = Date.now();
                if (!isPlaying) {
                    fadeInAudio();
                }
            }
        }, false);

        // 1) Create the audio object
        const audio = new Audio('sounds/Underwater-sounds-loopable.wav');
        audio.loop = true;
        audio.volume = 0;
        let isPlaying = false;
        let fadeInterval = null;
        let lastScrollTime = 0;

        function fadeInAudio() {
            if (fadeInterval) clearInterval(fadeInterval);
            if (audio.paused) {
                audio.play().catch(err => console.warn('Audio playback failed:', err));
            }
            isPlaying = true;

            const targetVolume = 1.0;
            const fadeSteps = 10;
            const stepDuration = 100;
            let currentStep = 0;

            fadeInterval = setInterval(() => {
                currentStep++;
                const newVolume = (currentStep / fadeSteps) * targetVolume;
                audio.volume = Math.min(newVolume, targetVolume);

                if (currentStep >= fadeSteps) {
                    clearInterval(fadeInterval);
                    fadeInterval = null;
                }
            }, stepDuration);
        }

        function fadeOutAudio() {
            if (fadeInterval) clearInterval(fadeInterval);
            isPlaying = false;

            const initialVolume = audio.volume;
            const fadeSteps = 10;
            const stepDuration = 100;
            let currentStep = 0;

            fadeInterval = setInterval(() => {
                currentStep++;
                const newVolume = initialVolume * (1 - currentStep / fadeSteps);
                audio.volume = Math.max(newVolume, 0);

                if (currentStep >= fadeSteps) {
                    clearInterval(fadeInterval);
                    fadeInterval = null;
                    audio.pause();
                }
            }, stepDuration);
        }

        document.body.addEventListener('click', () => {
            lastScrollTime = Date.now();
            if (!isPlaying) {
                fadeInAudio();
            }
        });

        setInterval(() => {
            if (isPlaying) {
                const now = Date.now();
                const elapsed = now - lastScrollTime;
                if (elapsed >= 3000) {
                    fadeOutAudio();
                }
            }
        }, 250);

        // Stack GIF references
        const gif1 = document.getElementById('gif1');
        const gif2 = document.getElementById('gif2');
        const gif3 = document.getElementById('gif3');

        let sequenceStarted = false;

        scroll.on('scroll', (obj) => {
            // track scroll time
            lastScrollTime = Date.now();

            if (!isPlaying) {
                fadeInAudio();
            }

            // Check if stack-section is in view and sequence hasn't started
            if (obj.currentElements['stack-section'] && !sequenceStarted) {
                const progress = obj.currentElements['stack-section'].progress;
                if (progress > 0.1) { // Section is at least 10% in view
                    sequenceStarted = true;

                    // Show first GIF immediately
                    gif1.classList.add('visible');

                    // Show second GIF after 2 seconds
                    setTimeout(() => {
                        gif2.classList.add('visible');
                    }, 2000);

                    // Show third GIF after 4 seconds
                    setTimeout(() => {
                        gif3.classList.add('visible');
                    }, 4000);

                    // go to freefall.html after 6 seconds
                    setTimeout(() => {
                        window.location.href = 'freefall.html';
                    }, 6000);
                }
            }
        });
    </script>

</body>

</html>